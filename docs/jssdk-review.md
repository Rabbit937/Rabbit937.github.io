---
sticky : 30
description : 产出了屎山项目的总结，是为了以后的项目不是屎。
---

# jssdk项目复盘

**作为第一个完全由本人一个人独立开发的项目，来复盘一下前期规划没有，走一步看一步的痛点。**

## 项目环境内容
1. 系统：win11
2. 开发环境：node@16.15.0 + vue@3.2.25 + vite@2.9.9 + vant@3.5.2
3. 项目需求：手游sdk，支持横竖屏

## 几个特殊的项目点
1. 借用 **@fingerprintjs/fingerprintjs** 指纹库，生成浏览器指纹，用作设备唯一id(及duid)。默认储存在 localStorage 里面。你要问这样怎么样唯一的话？其实这个只是假的唯一，在浏览器中使用时，清楚 localStorage 缓存，就会重新生成。不过我们的使用场景一般都是在Android或者IOS的webview里面使用。需要在页面渲染之前生成。
2. 对于横竖屏的处理，使用的是 **postcss-px-to-viewport** 插件。挺好用的一个插件，可以把px转化成vw。千万别用他的自动横竖屏转换。
3. 由于要和游戏研发通信，需要频繁的使用iframe的postMessage传消息给cp，还需要监听**message**事件，收到cp的通信。

## 几个快要了我老命的问题
1. 使用vite2点几版本的时候，突然没办法在使用```pnpm dev --host```的情况下，用ip加端口的方式在局域网访问。 然后就需要使用这个插件 **@vitejs/plugin-basic-ssl**来解决不受信任的证书的问题。vite3已不需要使用。
2. 复制问题，本来我使用的是**clipboard**插件，正常情况下dom渲染之后，绑定选择器，然后可以正常复制。但是这种方式实在是不灵活。后来我是更换 **@vueuse/core**中的复制方法，直呼好用，直呼牛逼，不用提前绑点选择器，可以纯函数的使用调用。我觉得直接起飞了。然后被运营打回了，在雷神模拟器下，复制不成功。然后疯狂百度，到了一个原生js的方式。然后成功的解决了我的问题，js才是最牛逼的，贴下代码。
![原生js复制](/jssdk-review/copy.png)

## 开始上饭(可能不是饭是屎)
1. 调用接口部分封装，部分图省事没有封装。
2. 滥用状态，基本上一个组件一个状态。
3. 代码重复度高，没有合理的封装。
4. 样式的冗余与重复非常高(小声bb：css太难了)
5. 规划问题，根组件横竖屏通过切换组件实现，导致游戏闪退，黑屏。(这一点，我当时脑子真实瓦特了)
6. 使用vue3在setup的情况下，使用对象存取状态，导致状态丢失。(setup内部参数只会执行一次，在我第二次调用的时候还是使用上一次的初始状态。)
7. ts的状态支持不全(妈的，不会用ts，不如直接js)
8. git提交没有规范，老是随便写(你他妈自己知道更新了什么吗？)